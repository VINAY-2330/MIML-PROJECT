# ==============================================================================
# LAMMPS Input Script for Cu64Zr36 Metallic Glass Plasticity
# Purpose: Generate data for ML Model (Cooling Rate -> Voronoi -> Yield Strength)
# ==============================================================================

# --- 1. INITIALIZATION ---
units           metal
dimension       3
boundary        p p p
atom_style      atomic

# --- 2. SYSTEM DEFINITION ---
# Create a simulation box for ~32,000 atoms
lattice         fcc 3.615
region          simbox block 0 20 0 20 0 20
create_box      2 simbox

# Create atoms: Type 1 = Cu, Type 2 = Zr
create_atoms    1 box
# Randomly replace 36% of Cu atoms with Zr to get Cu64Zr36
set             group all type/fraction 2 0.36 87234

# Atomic Masses (Optional if EAM file has them, but good practice)
mass            1 63.546  # Cu
mass            2 91.224  # Zr

# --- 3. INTERATOMIC POTENTIAL ---
# Using Embedded Atom Method (EAM) - Mendelev Potential
pair_style      eam/fs
pair_coeff      * * CuZr_mm.eam.fs Cu Zr

# --- 4. ENERGY MINIMIZATION (Relax initial overlap) ---
minimize        1.0e-4 1.0e-6 100 1000
reset_timestep  0

# --- 5. MELTING (Heat to 2000K) ---
velocity        all create 2000.0 4928459 dist gaussian
timestep        0.002 # 2 fs

fix             1 all npt temp 2000.0 2000.0 0.1 iso 0.0 0.0 1.0
run             20000 # 40 ps
unfix           1

# --- 6. QUENCHING (The Control Variable) ---
# Cooling from 2000K to 300K.
# Change 'run' steps here to alter Cooling Rate (Feature 1)
# 100,000 steps = ~8.5 x 10^12 K/s
# 1,000,000 steps = ~8.5 x 10^11 K/s

fix             1 all npt temp 2000.0 300.0 0.1 iso 0.0 0.0 1.0
run             100000 
unfix           1

# Equilibration at 300K
fix             1 all npt temp 300.0 300.0 0.1 iso 0.0 0.0 1.0
run             10000
unfix           1

# --- 7. FEATURE ENGINEERING (Voronoi Analysis) ---
# This computes the ML Features BEFORE deformation.
# Voronoi/atom returns: Volume, Neighbors (Faces)
# To get full indices <n3, n4, n5, n6>, usually requires post-processing (OVITO)
# or using a specific compute if installed.
# Here we dump the structure for OVITO analysis.

compute         voro all voronoi/atom
compute         pe all pe/atom

# Dump file for ML Feature Extraction (Icosahedra counting happens here externally)
dump            1 all custom 1 dump.ml_features.300K id type x y z c_pe c_voro[1] c_voro[2]
run             0
undump          1

# --- 8. TENSILE TEST (Deformation) ---
reset_timestep  0

# Define Strain Calculation
variable        tmp equal "lx"
variable        L0 equal ${tmp}
variable        strain equal "(lx - v_L0)/v_L0"

# Define Stress Calculation (Virial Stress -> GPa)
compute         peratom all stress/atom NULL
compute         p all reduce sum c_peratom[1] c_peratom[2] c_peratom[3]
variable        press_x equal -(c_p[1])/(vol*10000)
variable        press_y equal -(c_p[2])/(vol*10000)
variable        press_z equal -(c_p[3])/(vol*10000)

# Fix lateral dimensions (NPT) to allow Poisson contraction
# Deform x-dimension at constant strain rate
fix             1 all npt temp 300.0 300.0 0.1 y 0.0 0.0 1.0 z 0.0 0.0 1.0
fix             2 all deform 1 x erate 0.0001 units box remap x

# Output Stress-Strain Data (Target Label Calculation)
fix             3 all ave/time 10 100 1000 v_strain v_press_x v_press_y v_press_z file stress_strain_data.txt

# Dump Movie for Visualization
dump            2 all custom 1000 dump.tensile.lammpstrj id type x y z c_pe

# Run until 15% Strain
run             150000

print           "SIMULATION DONE"